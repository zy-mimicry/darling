<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PRI_System: QTI Manager</title>
	<meta http-equiv="X-UA-Compatible" content="IE=8"/>
    <link href="../LigerUI/lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <script src="../LigerUI/lib/jquery/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/core/base.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script> 
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerResizable.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>

    <!--script src="../CustomersData.js" type="text/javascript"></script-->
    <script type="text/javascript">
        var g;
        //var CustomersData = {Rows:[{"ID":"0","CustomPrjName":"1","SWIPrjName":"2","ParentSKU":"3","SKU":"4","PackagePN":"5","Product":"6","Customer":"7","CarrierPN":"8","Category":"9","Description":"10","CreateDate":"11","UpdateDate":"12"},{"ID":"0","CustomPrjName":"1","SWIPrjName":"2","ParentSKU":"3","SKU":"4","PackagePN":"5","Product":"6","Customer":"7","CarrierPN":"8","Category":"9","Description":"10","CreateDate":"11","UpdateDate":"12"},{"ID":"0","CustomPrjName":"1","SWIPrjName":"2","ParentSKU":"3","SKU":"4","PackagePN":"5","Product":"6","Customer":"7","CarrierPN":"8","Category":"9","Description":"10","CreateDate":"11","UpdateDate":"12"}],Total:3} ;
        //var CustomersData = {Rows:[{"id":"1","CustomPrjName":"None","SWIPrjName":"","ParentSKU":"None","SKU":"","PackagePN":"None","Product":"","Customer":"","CarrierPN":"None","Category":"None","Description":"None","CreateDate":"2018-08-06 12:21:40.763000+00:00","UpdateDate":"2018-08-06 12:21:40.763000+00:00"}],Total:1 };
        var CustomersData = {Rows:[
{"id":"1","CustomPrjName":"None","SWIPrjName":"","SKU":"","PackagePN":"None","Product":"","Customer":"","CarrierPN":"None","Category":"None","ParentSKU":"None","Description":"None","CreateDate":"2018-08-06 12:21:40.763000+00:00","UpdateDate":"2018-08-06 12:21:40.763000+00:00"},
{"id":"2","CustomPrjName":"OCU3-L","SWIPrjName":"Cougar","SKU":"1103367","PackagePN":"9906982","Product":"AR7582-1","Customer":"VW","CarrierPN":"9907611_ATT/ 9907676_VZW/ 9907613_T-Mobile","Category":"Commercial","ParentSKU":"101103367","Description":"None","CreateDate":"2018-08-07 03:04:58.748000+00:00","UpdateDate":"2018-08-07 03:04:58.748000+00:00"}
],Total:33 };
        /*var CustomersData = rlt|safe;*/
        var CategoryData = [{ Category: 'Commercial', text: 'Commercial' }, { Category: 'Lab', text: 'Lab'}];
        $.ligerDefaults.Grid.formatters['hplink'] = function (num, column) {
            num='<a class="l-link" href="'+num+'" target="_blank">'+num+'</a> ';
            return num;
         };
        $(function () {
            g = $("#maingrid4").ligerGrid({
                columns: [
                { display: 'ID', name: 'id', align: 'left', width: 60, //frozen: true, 
                    render: function (record, rowindex, value, column) {
                        //myurl='/pri_db/?op=query&tb=operate_list&id=' + value ;
                        return value;//"<input type='checkbox' id='"+value+"' /><a href=# onclick='$.ligerDialog.open({ title:\"PRI_System\",width: 900,height: 690,url: \""+myurl+"\" });return false;'>"+value+"</a>";
                    }, 
                },
                { display: 'UserName', name: 'UserName', width: 80, align: 'left' },
                { display: 'Operate', name: 'Operate', width: 62, align: 'left' },
                { display: 'Result', name: 'Result', width: 50, align: 'left'  },
                { display: 'UpdateDate', name: 'UpdateDate', width: 150, align: 'left' },
                { display: 'Description', name: 'Description', width: 800, align: 'left', 
                    render: function (record, rowindex, value, column) {
                        return "<div id='message1' title='"+value.replace(/\'/g,'&apos;').replace(/\"/g,'&quot;')+"' ondblclick='f_tip2(this.title);' >"+value+"</div>";
                    }, 
                
                },
                ],  
                rowAttrRender: function (rowdata,rowid) {
                    //if (rowdata.Category.toLowerCase().indexOf('commercial')>-1)   return "style='background:#80FF80;'";
                    return "";
                },
                //onDblClickRow: function (data, rowindex, rowobj) {
                //    myurl='/pri_db/?op=query&tb=operate_list&id=' + data.id ;
                //    $.ligerDialog.open({ title:"PRI_System",width: 900,height: 450,url: myurl});
                //},
                onAfterShowData :function (rowdata,rowid) {
                    if (select_ids) {f_select(true,select_ids);}
                    if (intclock==0) {load();}
                    $('[class="l-grid-row-cell-inner"]').each(function () {$(this).css('min-height',"20px");});
                },
                //checkbox : true, 
                alternatingRow: false,
                rowHeight: 20,
                headerRowHeight: 20,
                pageSizeOptions: [10,20, 22, 25,26,30, 33,38,40,50,100,200,500],
                pageSize:30,
                enabledSort : true,
                sortName:'id',
                sortOrder:'desc',
                enabledEdit: true,
                clickToEdit : false,
                url: '/pri_db/?op=list&tb=operate_list&fmt=json',
                dataType: 'server',
                dataAction: 'server',
                usePager: true,
                //method: 'GET',
                async: true,
                //root:'Rows',
                scroll: true,
                //delayLoad: true,
                //frozen:true,
                //alternatingRow: false,
                //scrollToPage: true,
                //scrollToAppend: true,
                //data: CustomersData,  
                //tree: { columnName: 'id' },
                width: '100%',height:'100%' 
            });
            //g.loadData();
            //search();

            $("#pageloading").hide();
            columns_data=[];
            columns_all='';
            columns_ids='';
            $(g.columns).each(function (i, column) {if (column.name) {columns_data.push({text:column.name,id:column.name});columns_all=columns_all+(columns_all?';':'')+column.name;if (column.hide!=true) {columns_ids=columns_ids+(columns_ids?';':'')+column.name;}} });
            $('#selcolumn').val(columns_ids);
        });
        function f_open()
        {
            $.ligerDialog.open({
                height:350,
                width: 400,
                title : 'Please Select the filter',
                url: '/test_select/test_select_data.htm', 
                showMax: false,
                showToggle: true,
                showMin: false,
                isResize: true,
                slide: false,
                onClose :function (item, dialog) { if (this.frame.isdirty) {f_toggleex();}},
                onLoaded :function (item, dialog) { this.frame.set_dialog(this);},
                buttons:[
                    { text:'OK',
                        onclick:function (item, dialog) { 
                            dialog.frame.f_ok();
                            //f_toggleex();
                            //dialog.close();
                        }}, 
                    { text: 'CLOSE', onclick: function (item, dialog) {dialog.close();}},
                    ],
                data:{
                    checkbox:[
                    //{name:'Product',text:'9x28;9x40',value:'9x28;9x40',ctrl:'selkey'},
                    //{name:'Status',text:Status_all,value:Status_val,ctrl:'selstatus'},
                    {name:'Column',text:columns_all,value:columns_ids,ctrl:'selcolumn'},
                    ],
                    inputbox:[
                    {name:'User Name',text:'',ctrl:'txtUserName'},
                    ],
                },
            });
        }        
        var select_ids='';
        function f_save_checkin()
        {
            var txt='';
            $(':checkbox').each(function (index, domEle) {
                id_attr=$(this).attr('id');
                if (id_attr && domEle.checked) {
                txt=txt+","+id_attr;
                }
            });
            select_ids=txt;
            return txt;
        }
        function f_add_checkin()
        {
            var txt=f_save_checkin();
            if (txt!='') {
                $.ligerDialog.confirm('Do you want to add to check in request?','Tips', function (yes) {
                    if (yes) $.ligerDialog.open({ title:'PRI_System check in request',width: 400,height: 300,url: '/pri_db/?op=add&tb=checkin_list&id='+txt }); 
                });
            } else {
                $.ligerDialog.warn('No Ticket selected!','Tips');
            }
        }
        function f_rmv_checkin()
        {
            var txt='';
            $(':checkbox').each(function (index, domEle) {
                id_attr=$(this).attr('id');
                if (id_attr && domEle.checked) {
                txt=txt+","+id_attr;
                }
            });
            if (txt!='') {
                $.ligerDialog.confirm('Do you want to remove to check in request?', function (yes) {
                    if (yes) $.ligerDialog.open({ title:'PRI_System check in request',width: 400,height: 300,url: '/pri_db/?op=remove&tb=checkin_list&id='+txt }); 
                });
            } else {
                $.ligerDialog.warn('No Ticket selected!');
            }
        }
        function f_select(attr_chk,ids)
        {
            var txt='';
            $(':checkbox').each(function (index, domEle) {
                attr_id=$(this).attr('id');
                txt=txt+','+attr_id;
                if (attr_id) {
                    if (ids) {
                        nmes=ids.split(',');
                        for (i=0,leni=nmes.length;i<leni;i++) {
                            if (attr_id==nmes[i]) {
                            //$("#"+attr_id).attr("checked",attr_chk);
                            domEle.checked=(attr_chk==''?!domEle.checked:attr_chk);
                         }   
                        }
                    } else {
                        domEle.checked=(attr_chk==''?!domEle.checked:attr_chk);
                    }
                }
            });
        }
        function f_op_menu(obj) 
        {
            if (obj.value=='add') {f_add_checkin();}
            else if (obj.value=='remove') {f_rmv_checkin();}
            else if (obj.value=='editfield') {f_editfield();}
            else if (obj.value=='search') {search();}
            else {alert('Not Support Now!');}
            obj.value='';
        }
        function f_toggleex() {f_toggle($("#selcolumn").val(),columns_all);search('first');}
        function f_toggle(columns_sel,columns_all)
        {
            nmes=columns_all.split(';');
            sels=columns_sel.split(';');
            for (i=0,leni=nmes.length;i<leni;i++) {
                isshow=false;
                for (j=0,lenj=sels.length;j<lenj;j++) {
                    if (nmes[i]==sels[j]) {isshow=true;break;}
                }
                g.toggleCol(nmes[i], isshow);
            }
        } 
        function search(ctype) {
            if (0) {
                AR758X_c=$("#AR758X").prop('checked');
                AR759X_c=$("#AR759X").prop('checked');
                Com_c=$("#Commercial").prop('checked');
                Lab_c=$("#Lab").prop('checked');
                if (AR758X_c && AR759X_c) {$("#txtProduct").val('AR75');}
                if (AR758X_c && !AR759X_c ) {$("#txtProduct").val('AR758X');}
                if (!AR758X_c && AR759X_c) {$("#txtProduct").val('AR759X');}
                if (!AR758X_c && !AR759X_c) {$("#txtProduct").val('');}
                if (Com_c && Lab_c) {Lab_v='Commercial|Lab';}
                if (Com_c && !Lab_c) {Lab_v='Commercial';}
                if (!Com_c && Lab_c) {Lab_v='Lab';}
                if (!Com_c && !Lab_c) {Lab_v='Commercial|Lab';}
            }
            var params = {　
                            filter_keys:'UserName__iregex',
                            //Product:$("#txtProduct").val().replace("X","").replace("x",""),
                            //Customer:$("#txtCustomer").val(),
                            UserName:$("#txtUserName").val(),
                            sortorder:g.options.sortOrder,
                            sortname:g.options.sortName,
                            page: g.options.page,
                            pagesize:g.options.pageSize
            };
            g.setOptions({parms : params});
            g.loadServerData(params);
            if (ctype)
                g.changePage(ctype);
            
        }
        var intclock=0;
        function load() {
            search('first');
            intclock=self.setInterval("search()",10000);
        }
        function goodbye() {
            self.clearInterval(intclock);
        }
    var tip;
    var num = 0;
    function f_tip2(msg) {
            tip = $.ligerDialog.alert(msg.replace(/\n/g,'<br/>'),'PRI_System');
        /*if (!tip) {alert
            tip = $.ligerDialog.tip({ title: 'PRI_System', content: msg });
        }
        else {
            var visabled = tip.get('visible');
            if (!visabled) tip.show();
            tip.set('content', msg);
        }*/
    } 
        </script>
</head>
<body style="padding:6px; overflow:hidden;" onunload="goodbye()">
<form>
   <table>
   <tr>
    <td style='width:30px'> &nbsp;<input type="checkbox" onclick="f_select(this.checked);" value="Select" />  </td>
    <td > &nbsp;<input type="hidden" id="txtUserName" value="" />  </td>
    <td> &nbsp;
                  <select id="op_menu" name="op_menu" onchange="f_op_menu(this);return false;" >
                    <option value="" >Please select your operation:</option>
                    <option value="search" >search</option>
                </select>

    </td>
    <!--
    <td> &nbsp;<input type="button" onclick="f_add_checkin();return false" value="Add to Check-in Request" /> </td>
    <td> &nbsp;<input type="button" onclick="f_rmv_checkin();return false" value="Remove from Check-in Request" /> </td>
    -->
    <td> &nbsp;<input type="submit" onclick="f_open();return false" value="filter" /> </td>
    <td>&nbsp; &nbsp;</td> <td><input type="hidden" id="selcolumn" style="color:#ffffff;" /> </td>
    </tr>
    </table>
</form>  
    
    <div id="maingrid4" style="margin:0; padding:0"></div>
 


  <div style="display:none;">
  <!-- g data total ttt -->
</div>
 
</body>
</html>
