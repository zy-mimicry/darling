<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PRI_System: SKU Manager</title>
	<meta http-equiv="X-UA-Compatible" content="IE=8"/>
    <link href="../LigerUI/lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <script src="../LigerUI/lib/jquery/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/core/base.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script> 
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerResizable.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="../LigerUI/lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>

    <!--script src="../CustomersData.js" type="text/javascript"></script-->
    <script type="text/javascript">
        var g;
        //var CustomersData = {Rows:[{"ID":"0","CustomPrjName":"1","SWIPrjName":"2","ParentSKU":"3","SKU":"4","PackagePN":"5","Product":"6","Customer":"7","CarrierPN":"8","Category":"9","Description":"10","CreateDate":"11","UpdateDate":"12"},{"ID":"0","CustomPrjName":"1","SWIPrjName":"2","ParentSKU":"3","SKU":"4","PackagePN":"5","Product":"6","Customer":"7","CarrierPN":"8","Category":"9","Description":"10","CreateDate":"11","UpdateDate":"12"},{"ID":"0","CustomPrjName":"1","SWIPrjName":"2","ParentSKU":"3","SKU":"4","PackagePN":"5","Product":"6","Customer":"7","CarrierPN":"8","Category":"9","Description":"10","CreateDate":"11","UpdateDate":"12"}],Total:3} ;
        //var CustomersData = {Rows:[{"id":"1","CustomPrjName":"None","SWIPrjName":"","ParentSKU":"None","SKU":"","PackagePN":"None","Product":"","Customer":"","CarrierPN":"None","Category":"None","Description":"None","CreateDate":"2018-08-06 12:21:40.763000+00:00","UpdateDate":"2018-08-06 12:21:40.763000+00:00"}],Total:1 };
        var CustomersData = {Rows:[
{"id":"1","CustomPrjName":"None","SWIPrjName":"","SKU":"","PackagePN":"None","Product":"","Customer":"","CarrierPN":"None","Category":"None","ParentSKU":"None","Description":"None","CreateDate":"2018-08-06 12:21:40.763000+00:00","UpdateDate":"2018-08-06 12:21:40.763000+00:00"},
{"id":"2","CustomPrjName":"OCU3-L","SWIPrjName":"Cougar","SKU":"1103367","PackagePN":"9906982","Product":"AR7582-1","Customer":"VW","CarrierPN":"9907611_ATT/ 9907676_VZW/ 9907613_T-Mobile","Category":"Commercial","ParentSKU":"101103367","Description":"None","CreateDate":"2018-08-07 03:04:58.748000+00:00","UpdateDate":"2018-08-07 03:04:58.748000+00:00"}
],Total:33 };
        /*var CustomersData = rlt|safe;*/
        var CategoryData = [{ Category: 'Commercial', text: 'Commercial' }, { Category: 'Lab', text: 'Lab'}];
        $.ligerDefaults.Grid.formatters['hplink'] = function (num, column) {
            num='<a class="l-link" href="'+num+'" target="_blank">'+num+'</a> ';
            return num;
         };
        $(function () {
            g = $("#maingrid4").ligerGrid({
                columns: [
                { display: 'ID', name: 'id', align: 'left', width: 50, //frozen: true, 
                    render: function (record, rowindex, value, column) {
                        myurl='/pri_db/?op=query&tb=sku_list&id=' + value ;
                        return "<a href=# onclick='$.ligerDialog.open({ title:\"PRI_System\",width: 900,height: 450,url: \""+myurl+"\" });return false;'>"+value+"</a>";
                    }, 
                },
                { display: 'Custom PrjName', name: 'CustomPrjName', width: 80, },
                { display: 'SWI PrjName', name: 'SWIPrjName',width: 80, },
                { display: 'Parent SKU', name: 'ParentSKU', width: 80, align: 'left', editor: { type: 'text'} },
                { display: 'SKU', name: 'SKU', width: 62, align: 'left' },
                { display: 'Package PN', name: 'PackagePN', width: 62, align: 'left' },
                { display: 'Product', name: 'Product', width: 65, align: 'left' },
                { display: 'Customer', name: 'Customer', width: 80, align: 'left' },
                { display: 'Carrier PN', name: 'CarrierPN', width: 300, align: 'left', editor: { type: 'text'} },
                { display: 'Category', name: 'Category', width: 80, align: 'left',editor: { type: 'select', data: CategoryData, valueField: 'Category' } },
                { display: 'Description', name: 'Description', width: 160, align: 'left', editor: { type: 'text'} },
                //{ display: 'CreateDate', name: 'CreateDate', width: 130, align: 'left', editor: { type: 'date'} },
                { display: 'UpdateDate', name: 'UpdateDate', width: 130, align: 'left', editor: { type: 'date'} },
                ],  
                rowAttrRender: function (rowdata,rowid) {
                    if (rowdata.Category.toLowerCase().indexOf('commercial')>-1)   return "style='background:#80FF80;'";
                    return "";
                },
                //onDblClickRow: function (data, rowindex, rowobj) {
                //    myurl='/pri_db/?op=query&tb=sku_list&id=' + data.id ;
                //    $.ligerDialog.open({ title:"PRI_System",width: 900,height: 450,url: myurl});
                //},
                onAfterShowData :function (rowdata,rowid) {},
                checkbox : true,  //每一行前面的选择框
                alternatingRow: false,
                rowHeight: 20,
                headerRowHeight: 20,
                pageSizeOptions: [10,20, 22, 25,26,30, 33,38,40,50,100,200,500],
                pageSize:30,
                enabledSort : true,//排序
                sortName:'id',
                sortOrder:'asc',
                enabledEdit: true,
                clickToEdit : false,
                url: '/pri_db/?op=list&tb=sku_list&fmt=json',
                dataType: 'server',
                dataAction: 'server',
                usePager: true,
                //method: 'GET',
                async: true,
                //root:'Rows',
                scroll: true,
                //delayLoad: true,
                //frozen:true,
                //alternatingRow: false,
                //scrollToPage: true,
                //scrollToAppend: true,
                //data: CustomersData,  
                //tree: { columnName: 'id' },
                isChecked: f_isChecked,
                width: '100%',height:'100%' 
            });
            //g.loadData();

            $("#pageloading").hide();
        });
        function f_isChecked(rowdata)
        {
            select_id_list = []
            
            if (select_ids != '')
            {
                select_id_list = select_ids.split(',')
                for (var id in select_id_list)
                {
                    if(select_id_list[id] == rowdata.id)
                    {
                        return true;
                    }
                }
            }
            return false;
        }
        
        function f_save_checkin()
        {
            var txt = ""
            var rows = g.getCheckedRows();
            $(rows).each(function ()
            {
                txt += this.id + ",";
            });
            return txt
        };
        function f_select()
        {
            var rows = g.rows;
            var select_reverse_ids = "";
            var select_list = [];
            var temp_select_list = [];
            var temp_unselect_list = [];
            
            select_reverse_ids = f_save_checkin();
            if(select_reverse_ids != '')
            {
                select_list = select_reverse_ids.split(',');
                for (var i = 0, l = rows.length; i < l; i++)
                {
                    exist_flag = 0;
                    var rowid = rows[i]['__id'];
                    obj = "tr[id^=maingrid4\\|2\\|"+rowid+"]";
                    var idstr=$(obj).attr("id");
                    var chkidstr=idstr.replace("|2|","\\|1\\|");
                    //console.log($("#"+chkidstr+">td")[0].parentElement)
                    var rowobj = g.getRowObj(rowid);
                        
                    for(var id in select_list)
                    {
                        if (select_list[id] != rows[i].id) {exist_flag = 1;}
                        else {exist_flag=0;break;}
                    }
                    if (exist_flag==1) 
                    {
                        temp_select_list.push(rows[i]);
                        $("#"+chkidstr).addClass("l-selected");
                        if (rowobj) $(rowobj).addClass("l-selected");
                    }
                    else
                    {
                        $("#"+chkidstr).removeClass("l-selected");
                        if (rowobj) $(rowobj).removeClass("l-selected");
                    }
                }
            }
            else
            {
                for (var i = 0, l = rows.length; i < l; i++)
                {   
                    temp_select_list.push(rows[i]);
                    obj = "tr[id^=maingrid4\\|2\\|"+rows[i].__id+"]";
                    var idstr=$(obj).attr("id");
                    var chkidstr=idstr.replace("|2|","\\|1\\|");
                    $("#"+chkidstr).addClass("l-selected");
                    var rowid = rows[i]['__id'];
                    var rowobj = g.getRowObj(rowid);
                    $(rowobj).addClass("l-selected");
                }
            }
            g.selected.length = 0;
            for (var i=0;i<temp_select_list.length;i++)
            {
                g.selected[g.selected.length] = temp_select_list[i];
                g.selected.length++;
            }
        };
        function f_changeHeaderText()
        {
            var txt = $("#txtCityHeader").val();
            g.changeHeaderText('City', txt);
        } 
        var select_ids='';
        function search(ctype, op) {
            select_ids = f_save_checkin();
            var params = {　
                            filter_keys:'SWIPrjName__icontains,Product__icontains,Customer__icontains',
                            Product:$("#txtProduct").val().replace("X","").replace("x",""),
                            Customer:$("#txtCustomer").val(),
                            SWIPrjName:$("#txtProject").val(),
                            //page:1,
                            page:g.options.page,
                            pagesize:g.options.pageSize
　　　　　　　　　　　　};
            g.setOptions({parms : params});
            g.loadServerData(params);
            g.changePage(ctype);
        }                
        var intclock=self.setInterval("search()",10000);
    </script>
</head>
<body style="padding:6px; overflow:hidden;">
<form>
  Project: <input type="text" id="txtProject" value="" /> Product: <input type="text" id="txtProduct" value="" /> Customer : <input type="text" id="txtCustomer" value="" />
    <input type="submit" onclick="search('first');return false" value="search" />
    <input type="button" onclick="search();return false" value="test" />
</form>  
    <div id="maingrid4" style="margin:0; padding:0"></div>
 


  <div style="display:none;">
  <!-- g data total ttt -->
</div>
 
</body>
</html>
